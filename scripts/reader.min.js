async function processFilters(){let e=$("#shuffleCheckbox").is(":checked"),t=$("#oneContextSentenceCheckbox").is(":checked"),n=$("#highlightVocabCheckbox").is(":checked"),a=$("#beginLevelTextBox").val(),r=$("#endLevelTextBox").val(),o=$("#numOfSentencesPerParagraphTextBox").val(),i=$("#fontSizeDropdown").val(),s=getApiToken(),l=await getUserData(s),c=l.level,g=await getVocabularyData(s,c),h=getSentences(g,t,a,r);adjustLevelFiltersIfNeeded(a,r,c),displaySentencesOnPage(h,e,n,o,i),$('[data-toggle="popover"]').popover()}function adjustLevelFiltersIfNeeded(e,t,n){e>n&&$("#beginLevelTextBox").val(n),t>n&&$("#endLevelTextBox").val(n)}function getApiToken(){let e="WaniKaniUserToken";return localStorage.getItem(e)}async function getUserData(e,t=1){let n="WaniKaniUserData",a=new Headers({"Wanikani-Revision":"20170710",Authorization:"Bearer "+e});if(sessionStorage.getItem(n))return Promise.resolve(JSON.parse(sessionStorage.getItem(n)));{let e=new Request("https://api.wanikani.com/v2/user",{method:"GET",headers:a});return fetch(e).then(e=>e.json()).then(e=>(sessionStorage.setItem(n,JSON.stringify(e.data)),e.data))}}async function getVocabularyData(e,t){let n="WaniKaniVocab";if(localStorage.getItem(n))return Promise.resolve(JSON.parse(localStorage.getItem(n)));{let a=getLevels(t),r="subjects?types=vocabulary&levels="+a,o=!0,i=[],s=new Headers({"Wanikani-Revision":"20170710",Authorization:"Bearer "+e}),l="https://api.wanikani.com/v2/"+r;for(;o;){let e=new Request(l,{method:"GET",headers:s}),t=await fetch(e).then(e=>e.json()).then(e=>e);t.data.forEach(e=>{var t={};t.level=e.data.level,t.characters=e.data.characters,t.context_sentences=e.data.context_sentences,t.meaning=e.data.meanings[0].meaning,t.reading=e.data.readings[0].reading,i.push(t)}),t.pages.next_url?l=t.pages.next_url:o=!1}return localStorage.setItem(n,JSON.stringify(i)),Promise.resolve(i)}}function displaySentencesOnPage(e,t,n,a,r){$("#mainContent").empty();let o=getSentencesForDisplay(e,n),i=t?shuffleArray(o):o,s=$("#mainContent"),l=a,c="";i.forEach(e=>{0===l?(s.append("<p>"+c+"</p>"),l=a,c=""):(c+=e,l--)}),s.css("font-size",r)}function getSentenceWithVocabHighlighted(e){let t="<b>Level:</b> "+e.level+"<br/><b>English reading:</b> "+e.meaning+"<br/><b>Japanese reading:</b> "+e.reading+"<br/><b>Sentence reading:</b> "+e.englishSentence;t=t.replace("'","");let n="<span class='vocab-word' data-toggle='popover' data-html='true' container='body' data-content='"+t+"'>"+e.vocabWord+"</span>",a=e.japaneseSentence.replace(e.vocabWord,n);return a}function getSentences(e,t,n,a){let r=[];return e.forEach(e=>{let o=e.level;if(o<n||o>a)return;let i=e.context_sentences;for(let n=0;n<i.length;n++){let a=e.level,o=e.characters,s=e.meaning,l=e.reading,c=i[n].ja,g=i[n].en;if(r.push({level:a,vocabWord:o,meaning:s,reading:l,japaneseSentence:c,englishSentence:g}),t)break}}),r}function getSentencesForDisplay(e,t){let n=[];return e.forEach(e=>{let a=t?getSentenceWithVocabHighlighted(e):e.japaneseSentence;n.push(a)}),n}function shuffleArray(e){let t=e.slice(0);for(var n=t.length-1;n>0;n--){var a=Math.floor(Math.random()*(n+1)),r=t[n];t[n]=t[a],t[a]=r}return t}function getLevels(e){for(var t=[],n=1;n<=e;n++)t.push(n);return t.join(",")}$(function(){let e=getApiToken();null==e&&(window.location.href="enter-token.html?returnUrl=reader.html")});